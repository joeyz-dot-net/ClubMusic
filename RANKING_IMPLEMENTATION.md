# æ’è¡Œæ¦œåŠŸèƒ½å®ç°å®ŒæˆæŠ¥å‘Š

## åŠŸèƒ½æ¦‚è¿°

å·²æˆåŠŸå®ç°å®Œæ•´çš„éŸ³ä¹æ’­æ”¾æ’è¡Œæ¦œåŠŸèƒ½ï¼ŒåŒ…æ‹¬å‰ç«¯ UIã€åç«¯ API å’Œæ•°æ®å¤„ç†ã€‚

## å®ç°æ¸…å•

### âœ… åç«¯å®ç° (app.py)

#### 1. `/ranking` ç«¯ç‚¹ (GET)
- **ä½ç½®**: app.py ç¬¬ 823 è¡Œ
- **åŠŸèƒ½**: è·å–æ’­æ”¾æ’è¡Œæ¦œï¼Œæ”¯æŒæŒ‰æ—¶é—´æ®µè¿‡æ»¤
- **å‚æ•°**: 
  - `period`: "all" (å…¨éƒ¨)ã€"week" (æœ¬å‘¨7å¤©)ã€"month" (æœ¬æœˆ30å¤©)
- **è¿”å›æ•°æ®ç»“æ„**:
  ```json
  {
    "status": "OK",
    "period": "all",
    "ranking": [
      {
        "url": "æ­Œæ›²URL",
        "title": "æ­Œæ›²æ ‡é¢˜",
        "type": "local/youtube",
        "thumbnail_url": "ç¼©ç•¥å›¾URL",
        "play_count": 13,
        "last_played": 1765722848
      }
    ]
  }
  ```
- **æ’åºè§„åˆ™**: æŒ‰ play_count é™åºï¼Œç›¸åŒæ’­æ”¾æ¬¡æ•°æŒ‰ last_played æ—¶é—´é™åº

### âœ… å‰ç«¯å®ç°

#### 1. RankingManager ç±» (static/js/ranking.js)
- **æ–‡ä»¶**: static/js/ranking.js (æ–°å»º)
- **ä¸»è¦æ–¹æ³•**:
  - `init()`: åˆå§‹åŒ–æ’è¡Œæ¦œç®¡ç†å™¨ï¼Œè®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢å’Œäº‹ä»¶ç›‘å¬
  - `setupTabSwitching()`: å¤„ç†ä¸‰ä¸ªæ ‡ç­¾é¡µ (å…¨éƒ¨/æœ¬å‘¨/æœ¬æœˆ) çš„åˆ‡æ¢
  - `loadRanking(period)`: è°ƒç”¨ API è·å–æŒ‡å®šæ—¶é—´æ®µçš„æ’è¡Œæ¦œæ•°æ®
  - `renderRanking(ranking)`: å°†æ•°æ®æ¸²æŸ“æˆ HTML å¹¶ç»‘å®šæ’­æ”¾æŒ‰é’®
  - `formatDate(timestamp)`: æ ¼å¼åŒ–æ—¥æœŸä¸ºä¸­æ–‡æ˜¾ç¤º ("ä»Šå¤©"ã€"æ˜¨å¤©"ã€"MæœˆDæ—¥")

#### 2. å‰ç«¯é›†æˆ
- **api.js**: æ·»åŠ äº†æ–¹æ³•
  - `getRanking(period='all')`: è°ƒç”¨ `/ranking` ç«¯ç‚¹
- **main.js**: å¯¼å…¥ rankingManager å¹¶åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶è°ƒç”¨ `rankingManager.init()`
- **index.html**: å·²åŒ…å«æ’è¡Œæ¦œæ¨¡æ€æ¡† HTML ç»“æ„ï¼ŒåŒ…å«ä¸‰ä¸ªæ ‡ç­¾é¡µå’Œå†…å®¹å®¹å™¨

#### 3. æ ·å¼è¡¨ (static/css/style.css)
- **æ–°å¢æ ·å¼ç±»**:
  - `.ranking-item`: æ’è¡Œæ¦œé¡¹ç›®å®¹å™¨ (flex å¸ƒå±€)
  - `.ranking-rank`: æ’ååŒºåŸŸï¼Œå«ç‰¹æ®Šæ ·å¼
    - ç¬¬ 1 å: é‡‘è‰²æ¸å˜èƒŒæ™¯
    - ç¬¬ 2 å: é“¶è‰²æ¸å˜èƒŒæ™¯
    - ç¬¬ 3 å: é“œè‰²æ¸å˜èƒŒæ™¯
  - `.ranking-number`: å¤§å·ç²—ä½“æ’åæ•°å­—
  - `.ranking-content`: æ­Œæ›²ä¿¡æ¯å®¹å™¨ (flex-1)
  - `.ranking-title`: æ­Œæ›²æ ‡é¢˜ (font-weight: 600)
  - `.ranking-meta`: æ’­æ”¾ç»Ÿè®¡ä¿¡æ¯åŒº (flex gap)
  - `.ranking-count`: æ’­æ”¾æ¬¡æ•°æ˜¾ç¤ºï¼Œå¸¦æ’­æ”¾ç¬¦å·å‰ç¼€ "â–¶"
  - `.ranking-date`: æœ€åæ’­æ”¾æ—¥æœŸ
  - `.ranking-play`: æ’­æ”¾æŒ‰é’®å®¹å™¨
  - `.ranking-play-btn`: å¸¦ hover æ•ˆæœçš„æ’­æ”¾æŒ‰é’®
  - `.ranking-empty`: ç©ºçŠ¶æ€æç¤º

### âœ… æ•°æ®æµ

```
å‰ç«¯ (UI)
    â†“
æ’è¡Œæ¦œæ ‡ç­¾é¡µç‚¹å‡» â†’ setupTabSwitching()
    â†“
loadRanking(period) â†’ api.getRanking(period)
    â†“
åç«¯ GET /ranking?period={all|week|month}
    â†“
æ ¹æ® playback_history.json è®¡ç®—æ’è¡Œæ¦œ
    â†“
è¿”å› JSON æ•°æ®
    â†“
renderRanking() ç”Ÿæˆ HTML
    â†“
ç”¨æˆ·çœ‹åˆ°æ’è¡Œæ¦œï¼Œç‚¹å‡»"æ’­æ”¾"æŒ‰é’®
    â†“
api.play(url, title, type) â†’ POST /play
```

## æ–‡ä»¶ä¿®æ”¹æ€»ç»“

### 1. app.py
- **è¡Œæ•°**: 919 è¡Œ â†’ 1002 è¡Œ
- **æ–°å¢ä»£ç **: 80 è¡Œ
- **æ–°å¢ç«¯ç‚¹**: 
  - `/ranking` (GET)

### 2. static/js/ranking.js
- **æ–°æ–‡ä»¶**: 126 è¡Œ
- **å†…å®¹**: å®Œæ•´çš„ RankingManager ç±»ï¼Œæ”¯æŒæ ‡ç­¾é¡µåˆ‡æ¢ã€æ•°æ®åŠ è½½å’Œæ¸²æŸ“

### 3. static/js/api.js
- **æ–°å¢æ–¹æ³•** (2 ä¸ª):
  - `getRanking(period)`
  - `clearPlaybackHistory()`

### 4. static/js/main.js
- **æ–°å¢å¯¼å…¥**: `import { rankingManager } from './ranking.js';`
- **æ–°å¢åˆå§‹åŒ–**: `await rankingManager.init();` (ç¬¬ 75 è¡Œ)
- **æ–°å¢äº‹ä»¶ç›‘å¬**: æ’è¡Œæ¦œæ¨¡æ€æ¡†çš„æ‰“å¼€/å…³é—­é€»è¾‘

### 5. static/css/style.css
- **æ–°å¢æ ·å¼**: 50+ è¡Œ
- **è¦†ç›–èŒƒå›´**: æ’è¡Œæ¦œé¡¹ç›®æ ·å¼ã€æ’åæ ·å¼ã€ç©ºçŠ¶æ€æ ·å¼

### 6. settings.ini
- **ä¿®æ”¹**: `server_port` ä» 80 æ”¹ä¸º 8000 è¿›è¡Œæµ‹è¯• (å·²æ”¹å› 80)

## æµ‹è¯•éªŒè¯

### âœ… API æµ‹è¯•ç»“æœ
```
INFO:     127.0.0.1:50162 - "GET /ranking?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:50162 - "GET /ranking?period=week HTTP/1.1" 200 OK
INFO:     127.0.0.1:50162 - "GET /ranking?period=month HTTP/1.1" 200 OK
```

### âœ… å‰ç«¯èµ„æºåŠ è½½
```
INFO:     127.0.0.1:49599 - "GET /static/js/ranking.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:50162 - "GET /static/js/main.js?v=3 HTTP/1.1" 304 Not Modified
```

### âœ… æ’­æ”¾å†å²æ•°æ®
- ç³»ç»Ÿå·²åŠ è½½ 39 æ¡æ’­æ”¾å†å²è®°å½•
- æ¯æ¡è®°å½•åŒ…å«: url, title, type, play_count, ts (æ—¶é—´æˆ³)
- æ”¯æŒæœ¬åœ°æ­Œæ›²å’Œ YouTube æµåª’ä½“

## åŠŸèƒ½ç‰¹æ€§

1. **ä¸‰ä¸ªæ—¶é—´æ®µæ’è¡Œ**: å…¨éƒ¨æ—¶é—´ã€æœ¬å‘¨ (7 å¤©)ã€æœ¬æœˆ (30 å¤©)
2. **åŠ¨æ€æ’åº**: æŒ‰æ’­æ”¾æ¬¡æ•° (é™åº)ï¼Œç›¸åŒæ¬¡æ•°æŒ‰æœ€åæ’­æ”¾æ—¶é—´æ’åº
3. **ä¸­æ–‡æ—¥æœŸæ ¼å¼åŒ–**: "ä»Šå¤© HH:MM"ã€"æ˜¨å¤© HH:MM"ã€"MæœˆDæ—¥"
4. **è§†è§‰åé¦ˆ**:
   - å‰ 3 åæœ‰ç‰¹æ®ŠèƒŒæ™¯è‰² (é‡‘ã€é“¶ã€é“œ)
   - æ¯é¡¹æœ‰æ’­æ”¾æŒ‰é’®
   - hover æ•ˆæœ

5. **ç©ºçŠ¶æ€å¤„ç†**: æ— æ•°æ®æ—¶æ˜¾ç¤º"ğŸ“Š æš‚æ— æ’­æ”¾æ•°æ®"
## å·²çŸ¥æ”¯æŒ

âœ… æœ¬åœ°éŸ³ä¹æ–‡ä»¶ (.mp3, .wav, .flac)  
âœ… YouTube æµåª’ä½“  
âœ… ç¼©ç•¥å›¾æ˜¾ç¤º (æ¥è‡ª YouTube)  
âœ… å®æ—¶æ’­æ”¾å†å²è¿½è¸ª  
âœ… è‡ªåŠ¨æ•°æ®æŒä¹…åŒ–

## è¿è¡Œè¯´æ˜

1. å¯åŠ¨åº”ç”¨: `python main.py`
2. æ‰“å¼€æµè§ˆå™¨: `http://localhost:80`
3. ç‚¹å‡»å¯¼èˆªæ ä¸­çš„"æ’è¡Œæ¦œ"æŒ‰é’® (æˆ–ç›¸åº”çš„å¯¼èˆªé¡¹)
4. åœ¨å¼¹å‡ºçš„æ’è¡Œæ¦œæ¨¡æ€æ¡†ä¸­åˆ‡æ¢æ—¶é—´æ®µæŸ¥çœ‹

## ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®® (å¯é€‰)

- [ ] æ·»åŠ å¯¼å‡ºæ’è¡Œæ¦œåŠŸèƒ½ (CSV/JSON)
- [ ] æ˜¾ç¤ºæ’è¡Œæ¦œçš„å‘¨ç¯æ¯”æ•°æ®
- [ ] æ·»åŠ "å¬æ„Ÿæœ€å¼º"çš„ç»Ÿè®¡ (æ€»æ’­æ”¾æ—¶é•¿)
- [ ] æ’è¡Œæ¦œåˆ†äº«åŠŸèƒ½
- [ ] å†å²æ’è¡Œæ¦œå¿«ç…§ (è®°å½•æ¯å¤©çš„æ’è¡Œ)
